{% extends 'base.html' %}

{% load static %}

{% block title %}
Task details
{% endblock %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col-11">
            <h1 class="title">{{ object.title }}</h1>
            {% if chat_id %}
                <a>Open chat
                    <a id="chat_link" onclick="onClick()" role="button"
                       value="{% url 'chat' chat_id %}" chat_id="{{ chat_id }}"><i class="fa-solid fa-comment"></i></a>
                </a>
            {% endif %}
            <p>Status: {{ object.get_status_display }}</p>
            <p> {{ object.description }} </p>
            <p> {{ object.realization_time }}</p>
            <p> {{ object.budget }} </p>
            {% if object.selected_offer %}
                <p>Selected offer: {{ object.selected_offer }}
                <a href="{% url 'offer-detail' object.selected_offer.id %}">|VIEW OFFER|</a>
                </p>
                {% if complaint %}
                <p> There is a complaint for this task:
                    <a href="{% url 'complaint-detail' complaint.id %}">|VIEW COMPLAINT|</a>
                 </p>
                {% elif is_ongoing %}
                  <p>
                    <a href="{% url 'complaint-create' object.id %}">|ADD COMPLAINT|</a>
                </p>
                {% endif %}

                {% if object.selected_offer.solution %}
                <hr class="navbar-divider">
                    <h4><a href="{% url 'solution-detail' object.selected_offer.solution.id %}">Solution:</a></h4>
                        {{object.selected_offer.solution.description|truncatewords:20}}

                {% endif %}
            {% else %}
            <p>No offer selected
                <a href="{% url 'task-offers-list' task.id %}">
                    <span>_____>> Offers for this task</span>
                </a>
            </p>
            {% endif %}
            {% if object.skills %}
            <p>
                {% for skill in object.skills.all %}
                #{{skill}}
                {% endfor %}
            </p>
            {% endif %}
            <hr class="navbar-divider">
            {% if attachments %}

                <p>Files:</p>
                <ul>
                {% for attachment in attachments %}
                    <li>
                        <a href="{% url 'task-attachment-download' attachment.id %}">{{attachment}}</a>
                        <a href="{% url 'task-attachment-delete' attachment.id %}">|X|</a>
                    </li>
                {% endfor %}
                </ul>
            {% endif %}
            <p>
                <a href="{% url 'task-add-attachment' object.id %}">|ADD ATTACHMENT|</a>
            </p>
            <hr class="navbar-divider">
            <p>
                <a href="{% url 'task-edit' object.id %}">|EDIT|</a>
                <a href="{% url 'task-delete' object.id %}">|DELETE|</a>
            </p>
            <hr class="navbar-divider">
            <div>
                <a href="{% url 'tasks-client-list' %}">|ALL TASKS|</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    <script type='text/javascript' src="{% static 'tasksapp/script-chat-new-window.js' %}"></script>
{% endblock %}
